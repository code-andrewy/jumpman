<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Jumpman64</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root{
  --bg:#0b0b0b;
  --muted:rgba(255,255,255,0.65);
  --accent:#1e90ff;
  --card-bg:rgba(255,255,255,0.03);
  --card-hover:rgba(255,255,255,0.05);
  --transition:0.35s cubic-bezier(0.4,0,0.2,1);
}
*{box-sizing:border-box}
body{
  background:var(--bg);
  color:#fff;
  font-family:"Segoe UI",Arial,sans-serif;
  margin:0;
  padding:0;
  overflow-x:hidden;
  -webkit-font-smoothing:antialiased;
  display:flex;
  flex-direction:column;
  align-items:center;
}

/* Header */
header{
  background:rgba(20,20,20,0.45);
  padding:14px 20px;
  display:flex;
  gap:18px;
  align-items:center;
  justify-content:center;
  position:sticky;top:0;z-index:60;
  border-bottom:1px solid rgba(255,255,255,0.04);
  backdrop-filter: blur(8px);
  transition:all 0.3s ease;
}
header:hover{transform:translateY(-2px)}
.header-left{position:relative}

/* Search */
#search{
  padding:12px 14px;
  width:320px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.08);
  background:rgba(255,255,255,0.03);
  color:#fff;
  outline:none;
  transition:all 0.3s ease;
}
#search:focus{width:380px;transform:scale(1.02)}

.suggestions{
  position:absolute;left:0;top:46px;
  width:320px;
  background:rgba(18,18,18,0.95);
  border-radius:12px;
  padding:6px;
  display:none;
  z-index:200;
  box-shadow:0 8px 30px rgba(0,0,0,0.6);
  opacity:0;
  transform:translateY(-10px);
  transition:opacity 0.3s ease, transform 0.3s ease;
}
.suggestions.show{
  display:block;
  opacity:1;
  transform:translateY(0);
}
.suggestions div{
  padding:10px;
  border-radius:10px;
  cursor:pointer;
  transition:background 0.2s, transform 0.2s;
}
.suggestions div:hover{
  background:rgba(255,255,255,0.02);
  transform:scale(1.02);
}

/* Header widgets */
#streak{font-weight:600}
#weather{display:flex;gap:8px;align-items:center}

/* Sections */
section{
  display:flex;
  flex-direction:column;
  align-items:center;
  margin:22px 14px;
  opacity:0;
  transform:translateY(20px);
  animation:fadeInUp 0.7s forwards;
  transition:all 0.3s ease;
}
section h2{
  margin:6px 0 16px;
  font-size:1.6rem;
  letter-spacing:0.6px;
  text-align:center;
}

/* Lists */
#highlightList,#gameList,#favList,#continueList{
  display:flex;
  flex-wrap:wrap;
  gap:18px;
  justify-content:center;
  max-width:1400px;
  width:100%;
}

/* Card */
.game-card{
  width:220px;
  background:var(--card-bg);
  padding:16px;
  border-radius:14px;
  text-align:center;
  position:relative;
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.04);
  transform-origin:center center;
  box-shadow:0 8px 28px rgba(0,0,0,0.5);
  opacity:0;
  animation:fadeInCard 0.6s forwards;
  transition:transform var(--transition), background var(--transition), box-shadow var(--transition);
}
.game-card:hover{
  transform:translateY(-6px) scale(1.05);
  background:var(--card-hover);
  box-shadow:0 12px 40px rgba(0,0,0,0.6);
}
.thumb-wrapper{
  height:140px;
  overflow:hidden;
  border-radius:10px;
}
.thumb{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  transition:transform var(--transition);
}
.thumb-wrapper:hover .thumb{transform:scale(1.08)}

/* icons */
.bookmark-icon{
  position:absolute;top:10px;left:10px;
  background:rgba(0,0,0,0.45);
  padding:6px 8px;border-radius:10px;
  cursor:pointer;
  transition:all 0.25s ease;
}
.bookmark-icon i{color:#fff;transition:color 0.3s}
.bookmark-icon i.bookmarked{color:var(--accent)}
.remove-icon{
  position:absolute;top:10px;right:10px;
  background:rgba(255,0,0,0.18);
  padding:6px;border-radius:10px;
  cursor:pointer;
  transition:all 0.25s ease;
}
.remove-icon i{color:#fff}
.remove-icon:hover{background:rgba(255,0,0,0.35);transform:scale(1.1)}

/* Player overlay fullscreen */
#player{
  position:fixed;inset:0;
  background:#000;
  display:none;
  flex-direction:column;
  z-index:999;
  align-items:stretch;
  justify-content:stretch;
}
#playerHeader{
  position:absolute;
  top:14px;
  left:0;
  width:100%;
  z-index:1100;
  display:flex;
  justify-content:center;
  pointer-events:none;
}
#backBtn{
  position:absolute;
  top:14px;
  left:14px;
  pointer-events:all;
  background:rgba(32,32,32,0.9);
  padding:10px;
  border-radius:12px;
  cursor:pointer;
  z-index:1101;
  border:1px solid rgba(255,255,255,0.04);
  transition:all 0.3s ease;
}
#backBtn:hover{transform:scale(1.05)}
#backBtn i{font-size:18px}
#playerTitle{
  position:absolute;
  top:14px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(28,28,28,0.8);
  padding:8px 16px;
  border-radius:12px;
  z-index:1101;
  text-align:center;
  pointer-events:all;
}
#gameContainer{
  flex:1;
  width:100%;
  height:100%;
  display:flex;
  align-items:stretch;
  justify-content:stretch;
  overflow:hidden;
}

/* injected wrapper */
.injected-wrapper{
  width:100%;
  height:100%;
  display:flex;
  align-items:stretch;
  justify-content:stretch;
}
.injected-wrapper iframe,
.injected-wrapper > *{
  width:100%;
  height:100%;
}

/* no-results */
.no-results{text-align:center;padding:24px;color:var(--muted);opacity:0;animation:fadeInUp 0.5s forwards}

/* Animations */
@keyframes fadeInUp{
  0%{opacity:0;transform:translateY(20px)}
  100%{opacity:1;transform:translateY(0)}
}
@keyframes fadeInCard{
  0%{opacity:0;transform:translateY(20px) scale(.95)}
  50%{transform:translateY(8px) scale(1.01)}
  100%{opacity:1;transform:translateY(0) scale(1)}
}
</style>
</head>
<body>

<header>
  <div class="header-left">
    <input id="search" placeholder="Search games..." />
    <div id="suggestions" class="suggestions"></div>
  </div>
  <div id="streak">Streak: üî• 0</div>
  <div id="weather"><span id="weatherEmoji">‚òÅÔ∏è</span>&nbsp;<span id="weatherText">Loading weather...</span></div>
</header>

<!-- PLAYER -->
<div id="player">
  <div id="playerHeader">
    <div id="backBtn" title="Close (Esc)"><i class="fa-solid fa-x"></i></div>
    <h3 id="playerTitle"></h3>
  </div>
  <div id="gameContainer"></div>
</div>

<!-- Highlight -->
<section id="highlightSection" style="display:none;">
  <h2><i class="fa-solid fa-star"></i> Highlights</h2>
  <div id="highlightList"></div>
</section>

<!-- Continue -->
<section id="continue" style="display:none;">
  <h2><i class="fa-solid fa-clock-rotate-left"></i> Continue Playing</h2>
  <div id="continueList"></div>
</section>

<!-- Favorites -->
<section id="favorites" style="display:none;">
  <h2><i class="fa-solid fa-bookmark"></i> Bookmarks</h2>
  <div id="favList"></div>
</section>

<!-- Results -->
<section id="results">
  <h2><i class="fa-solid fa-rocket"></i> Jumpman64</h2>
  <div id="gameList"></div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
<script>
/* ===================== ELEMENTS ===================== */
const gameList = document.getElementById("gameList");
const highlightList = document.getElementById("highlightList");
const favList = document.getElementById("favList");
const continueList = document.getElementById("continueList");
const continueSection = document.getElementById("continue");
const favoriteSection = document.getElementById("favorites");
const highlightSection = document.getElementById("highlightSection");
const search = document.getElementById("search");
const suggestions = document.getElementById("suggestions");
const streakEl = document.getElementById("streak");
const weatherEmoji = document.getElementById("weatherEmoji");
const weatherText = document.getElementById("weatherText");

const player = document.getElementById("player");
const playerTitle = document.getElementById("playerTitle");
const backBtn = document.getElementById("backBtn");
const gameContainer = document.getElementById("gameContainer");

/* ===================== STATE ===================== */
let allGames = [];
let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
let lastPlayed = JSON.parse(localStorage.getItem("continue") || "null");
let isSearching = false;

/* ===================== STORAGE ===================== */
function saveFavorites() {
  localStorage.setItem("favorites", JSON.stringify(favorites));
}
function saveContinue(name) {
  localStorage.setItem("continue", JSON.stringify(name));
}

/* ===================== PLAYER ===================== */
function openGame(name, url) {
  saveContinue(name);
  lastPlayed = name;
  player.style.display = "flex";
  playerTitle.textContent = name;
  gameContainer.innerHTML = `<p style="color:white;">Loading game...</p>`;

  fetch(url)
    .then(res => res.text())
    .then(html => {
      const wrapper = document.createElement("div");
      wrapper.className = "injected-wrapper";
      wrapper.innerHTML = html;
      gameContainer.innerHTML = "";
      gameContainer.appendChild(wrapper);

      // Execute inline scripts
      const scripts = wrapper.querySelectorAll("script");
      scripts.forEach(oldScript => {
        const newScript = document.createElement("script");
        if (oldScript.src) newScript.src = oldScript.src;
        else newScript.textContent = oldScript.textContent;
        document.body.appendChild(newScript);
        oldScript.remove();
      });
    })
    .catch(err => {
      gameContainer.innerHTML = `<p style="color:red;">Failed to load game</p>`;
      console.error(err);
    });

  renderContinue();
}

backBtn.onclick = () => {
  gameContainer.innerHTML = "";
  player.style.display = "none";
};

/* ===================== FETCH GAMES ===================== */
fetch("https://raw.githubusercontent.com/code-andrewy/jumpman/refs/heads/main/list.text")
  .then(res => res.text())
  .then(raw => {
    const lines = raw
      .split("\n")
      .map(l => l.trim())
      .filter(l => l !== "");

    for (let i = 0; i < lines.length; i += 3) {
      allGames.push({
        url: lines[i].replace("Website url:", "").trim(),
        name: lines[i + 1].replace("Game name:", "").trim(),
        img: lines[i + 2].replace("Image url:", "").trim()
      });
    }

    renderHighlightOfDay();
    renderFavorites();
    renderContinue();
    loadNextBatch();
  })
  .catch(err => console.error("Failed to load games list", err));

/* ===================== SEEDED RNG ===================== */
function seededRandom(seed) {
  return (Math.sin(seed) * 10000) % 1;
}

/* ===================== GAME CARD ===================== */
function createCard(g, delay = 0, isHighlight = false, isRemovable = false) {
  const isFav = favorites.includes(g.name);
  const div = document.createElement("div");
  div.className = "game-card";
  div.style.animationDelay = `${delay * 0.05}s`;

  div.innerHTML = `
    <div class="thumb-wrapper">
      <img src="${g.img}" class="thumb">
    </div>
    <strong>${g.name}</strong>
    <div class="bookmark-icon">
      <i class="fa-solid fa-bookmark ${isFav ? "bookmarked" : ""}"></i>
    </div>
  `;

  // Open game
  div.querySelector(".thumb-wrapper").onclick = () => openGame(g.name, g.url);

  // Toggle favorite
  div.querySelector(".bookmark-icon").onclick = e => {
    e.stopPropagation();
    toggleFavorite(g.name, div.querySelector(".bookmark-icon"));
  };

  // Removable buttons (recently played or favorites)
  if (isRemovable) {
    const removeBtn = document.createElement("div");
    removeBtn.className = "remove-icon";
    removeBtn.innerHTML = '<i class="fa-solid fa-trash"></i>';
    removeBtn.onclick = e => {
      e.stopPropagation();
      if (favList.contains(div)) removeFavorite(g.name);
      else if (continueList.contains(div)) removeContinue();
    };
    div.appendChild(removeBtn);
  }

  return div;
}

/* ===================== HIGHLIGHT ===================== */
function renderHighlightOfDay() {
  if (!allGames.length) return;
  highlightSection.style.display = "block";
  highlightList.innerHTML = "";

  const today = new Date();
  const seed = today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();

  const shuffled = [...allGames].sort(
    (a, b) => seededRandom(seed + a.name.charCodeAt(0)) - seededRandom(seed + b.name.charCodeAt(0))
  );

  shuffled.slice(0, 5).forEach((g, i) => {
    highlightList.appendChild(createCard(g, i, true, false));
  });
}

/* ===================== LAZY LOAD ===================== */
let currentIndex = 0;
const cardsPerRow = 5;
const rowsPerBatch = 3;

function loadNextBatch() {
  const batchSize = cardsPerRow * rowsPerBatch;
  const end = Math.min(currentIndex + batchSize, allGames.length);
  for (let i = currentIndex; i < end; i++) {
    gameList.appendChild(createCard(allGames[i], i - currentIndex));
  }
  currentIndex = end;
}

window.addEventListener("scroll", () => {
  if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 300) {
    if (!isSearching && currentIndex < allGames.length) loadNextBatch();
  }
});

/* ===================== FAVORITES ===================== */
function toggleFavorite(name, iconEl) {
  const iEl = iconEl.querySelector("i");
  if (!favorites.includes(name)) {
    favorites.push(name);
    iEl.classList.add("bookmarked");
  } else {
    favorites = favorites.filter(f => f !== name);
    iEl.classList.remove("bookmarked");
  }
  saveFavorites();
  renderFavorites();
}

function renderFavorites() {
  if (!favorites.length) {
    favoriteSection.style.display = "none";
    return;
  }
  favoriteSection.style.display = "block";
  favList.innerHTML = "";
  favorites.forEach(name => {
    const game = allGames.find(g => g.name === name);
    if (game) favList.appendChild(createCard(game, 0, false, true));
  });
}

function removeFavorite(name) {
  favorites = favorites.filter(f => f !== name);
  saveFavorites();
  renderFavorites();
}

/* ===================== CONTINUE ===================== */
function removeContinue() {
  lastPlayed = null;
  saveContinue(null);
  renderContinue();
}

function renderContinue() {
  if (!lastPlayed) {
    continueSection.style.display = "none";
    return;
  }
  const game = allGames.find(g => g.name === lastPlayed);
  if (!game) return;
  continueSection.style.display = "block";
  continueList.innerHTML = "";
  continueList.appendChild(createCard(game, 0, false, true));
}

/* ===================== SEARCH ===================== */
function showNoResults() {
  gameList.innerHTML = `<div class="no-results"><h2>‚ö†Ô∏è No results found</h2></div>`;
}

function renderFilteredResults(filtered) {
  isSearching = true;
  gameList.innerHTML = "";
  if (!filtered.length) {
    showNoResults();
    return;
  }
  filtered.forEach((g, i) => gameList.appendChild(createCard(g, i)));
}

search.addEventListener("input", () => {
  const q = search.value.toLowerCase().trim();
  suggestions.innerHTML = "";

  if (!q) {
    isSearching = false;
    suggestions.classList.remove("show");
    gameList.innerHTML = "";
    currentIndex = 0;
    loadNextBatch();
    return;
  }

  const filtered = allGames.filter(g => g.name.toLowerCase().includes(q));
  filtered.slice(0, 6).forEach(g => {
    const div = document.createElement("div");
    div.textContent = g.name;
    div.onclick = () => {
      search.value = g.name;
      suggestions.classList.remove("show");
      renderFilteredResults([g]);
    };
    suggestions.appendChild(div);
  });

  suggestions.classList.add("show");
  renderFilteredResults(filtered);
});

document.addEventListener("click", e => {
  if (!search.contains(e.target) && !suggestions.contains(e.target)) suggestions.classList.remove("show");
});

/* ===================== STREAK ===================== */
const todayStr = new Date().toISOString().split("T")[0];
let streakData = JSON.parse(localStorage.getItem("streakData") || '{"count":0,"lastLogin":""}');
if (streakData.lastLogin !== todayStr) {
  const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
  streakData.count = streakData.lastLogin === yesterday.toISOString().split("T")[0] ? streakData.count + 1 : 1;
  streakData.lastLogin = todayStr;
  localStorage.setItem("streakData", JSON.stringify(streakData));
}
streakEl.textContent = `Streak: üî• ${streakData.count}`;

/* ===================== WEATHER ===================== */
function updateWeather(lat = 43.4426, lon = -71.2776) {
  fetch(`https://api.weather.gov/points/${lat},${lon}`)
    .then(res => res.json())
    .then(data => fetch(data.properties.forecast))
    .then(res => res.json())
    .then(fore => {
      const f = fore.properties.periods[0];
      weatherText.textContent = `${f.temperature}¬∞${f.temperatureUnit} ‚Äî ${f.shortForecast}`;
      let emoji = "‚òÅÔ∏è";
      if (/sunny/i.test(f.shortForecast)) emoji = "‚òÄÔ∏è";
      else if (/rain/i.test(f.shortForecast)) emoji = "üåßÔ∏è";
      else if (/snow/i.test(f.shortForecast)) emoji = "‚ùÑÔ∏è";
      else if (/storm|thunder/i.test(f.shortForecast)) emoji = "‚õàÔ∏è";
      else if (/clear/i.test(f.shortForecast)) emoji = "üåû";
      weatherEmoji.textContent = emoji;
    })
    .catch(err => console.error("Failed to load weather", err));
}

updateWeather();
setInterval(updateWeather, 300000); // update every 5 min
</script>
</body>
</html>